import{d as H,O as Q,f as Z,r as c,n as ee,h as w,c as B,a as u,t as p,u as n,e as a,w as i,N as e,i as h,y as ae,I as te,B as D,a8 as k,aJ as le,aK as oe,E as ne,ah as se,ai as ie,aj as pe,as as ce,$ as de,W as re,X as ue,Y as me,aa as _e,a0 as fe,_ as ge}from"./index-9d601459.js";/* empty css                   *//* empty css                   *//* empty css                */import{_ as he}from"./index.vue_vue_type_style_index_0_lang-a29dba20.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                    */import{g as ve,a as be,b as we,s as xe,c as Ve}from"./weapp-37d6496a.js";import{a as Ce}from"./module-2228c4b8.js";/* empty css                    */const ye={class:"main-container min-h-[300px] p-5"},Te={class:"flex justify-between items-center mb-[20px]"},Ee={class:"text-[20px]"},Be={class:"mt-[50px]"},ke={key:0,class:"text-error"},Ue={key:0,class:""},We={class:"mt-[16px] flex justify-end"},ze={class:"dialog-footer"},Ne=H({__name:"code",setup(Re){const F=Q(),x=Z(),I=F.meta.title;c("1");const V=c(!1),t=ee({page:1,limit:10,total:0,loading:!1,data:[]}),d=c({desc:""}),C=c("");Ce().then(l=>{l.data.data&&l.data.data.auth_code&&(C.value=l.data.data.auth_code,T())}).catch(()=>{});const U=c({});ve().then(l=>{U.value=l.data});const y=c("/channel/weapp/code"),P=l=>{x.push({path:y.value})},W=c(null),m=(l=1)=>{t.loading=!0,t.page=l,we({page:t.page,limit:t.limit}).then(o=>{t.loading=!1,t.data=o.data.data,t.total=o.data.total,l==1&&t.data.length&&t.data[0].status==0&&N(t.data[0].task_key)}).catch(()=>{t.loading=!1})};m();const L=()=>{W.value.clearValidate()},_=c(!1),z=()=>{if(!C.value){M();return}if(!U.value.app_id){$();return}_.value||(_.value=!0,v.value="",xe(d.value).then(l=>{m(),T(),_.value=!1}).catch(()=>{_.value=!1}))},j=()=>{k.alert(e("localInsertTips"),e("warning"),{confirmButtonText:e("confirm")})},v=c(""),T=()=>{C.value&&be().then(l=>{l.data&&(v.value=`<img src="${l.data}" class="w-[150px]">`)}).catch()},N=l=>{Ve(l).then(o=>{const r=o.data.data??[];if(r[0]&&r[0].length){const f=r[0][r[0].length-1];if(f.code==0){m();return}if(f.code==1&&f.percent==100){m(),T();return}setTimeout(()=>{N(l)},2e3)}})},M=()=>{k.confirm(e("authTips"),e("warning"),{distinguishCancelAndClose:!0,confirmButtonText:e("toBind"),cancelButtonText:e("toNiucloud")}).then(()=>{x.push({path:"/app/authorize"})}).catch(l=>{l==="cancel"&&window.open("https://www.niucloud.com/app")})},$=()=>{k.confirm(e("weappTips"),e("warning"),{confirmButtonText:e("toSetting"),cancelButtonText:e("cancel")}).then(()=>{x.push({path:"/channel/weapp/config"})}).catch(l=>{})};return(l,o)=>{const r=le,f=oe,g=ne,b=se,A=ie,S=pe,J=ce,K=de,R=re,E=ue,O=he,X=me,Y=_e,q=fe;return w(),B("div",ye,[u("div",Te,[u("span",Ee,p(n(I)),1)]),a(f,{modelValue:y.value,"onUpdate:modelValue":o[0]||(o[0]=s=>y.value=s),class:"demo-tabs",onTabChange:P},{default:i(()=>[a(r,{label:n(e)("weappAccessFlow"),name:"/channel/weapp"},null,8,["label"]),a(r,{label:n(e)("subscribeMessage"),name:"/channel/weapp/message"},null,8,["label"]),a(r,{label:n(e)("weappRelease"),name:"/channel/weapp/code"},null,8,["label"])]),_:1},8,["modelValue"]),a(K,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[u("div",Be,[a(g,{type:"primary",onClick:z,loading:_.value,disabled:t.loading},{default:i(()=>[h(p(n(e)("cloudRelease")),1)]),_:1},8,["loading","disabled"]),a(g,{onClick:j,disabled:t.loading},{default:i(()=>[h(p(n(e)("localRelease")),1)]),_:1},8,["disabled"])]),ae((w(),te(S,{class:"mt-[15px]",data:t.data,size:"default"},{empty:i(()=>[u("span",null,p(n(e)("emptyData")),1)]),default:i(()=>[a(b,{prop:"version",label:n(e)("code"),align:"left"},null,8,["label"]),a(b,{prop:"status_name",label:n(e)("status"),align:"left"},{default:i(({row:s})=>[u("div",null,p(s.status_name),1),s.status==-1?(w(),B("div",ke,p(n(e)("failReason"))+p(s.fail_reason),1)):D("",!0)]),_:1},8,["label"]),a(b,{prop:"create_time",label:n(e)("createTime"),align:"center"},null,8,["label"]),a(b,{label:n(e)("operation"),fixed:"right",align:"right","min-width":"120"},{default:i(({row:s,$index:G})=>[v.value&&G==0&&s.status==1&&t.page==1?(w(),B("div",Ue,[a(A,{content:v.value,"raw-content":"",effect:"light"},{default:i(()=>[a(g,{type:"primary",link:""},{default:i(()=>[h(p(n(e)("preview")),1)]),_:1})]),_:1},8,["content"])])):D("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[q,t.loading]]),u("div",We,[a(J,{"current-page":t.page,"onUpdate:current-page":o[1]||(o[1]=s=>t.page=s),"page-size":t.limit,"onUpdate:page-size":o[2]||(o[2]=s=>t.limit=s),layout:"total, sizes, prev, pager, next, jumper",total:t.total,onSizeChange:m,onCurrentChange:m},null,8,["current-page","page-size","total"])])]),_:1}),a(Y,{modelValue:V.value,"onUpdate:modelValue":o[7]||(o[7]=s=>V.value=s),title:n(e)("codeDownTwoDesc"),width:"30%","before-close":L},{footer:i(()=>[u("span",ze,[a(g,{onClick:o[6]||(o[6]=s=>V.value=!1)},{default:i(()=>[h(p(n(e)("cancel")),1)]),_:1}),a(g,{type:"primary",onClick:z},{default:i(()=>[h(p(n(e)("confirm")),1)]),_:1})])]),default:i(()=>[a(X,{ref_key:"ruleFormRef",ref:W,model:d.value,rules:l.rules,"label-width":"120px"},{default:i(()=>[a(E,{prop:"code",label:n(e)("code")},{default:i(()=>[a(R,{modelValue:d.value.code,"onUpdate:modelValue":o[3]||(o[3]=s=>d.value.code=s),placeholder:n(e)("codePlaceholder"),onkeyup:"this.value = this.value.replace(/[^\\d\\.]/g,'');"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(E,{prop:"path",label:n(e)("path")},{default:i(()=>[a(O,{modelValue:d.value.path,"onUpdate:modelValue":o[4]||(o[4]=s=>d.value.path=s),api:"weapp/upload",accept:".zip"},null,8,["modelValue","accept"])]),_:1},8,["label"]),a(E,{label:n(e)("content")},{default:i(()=>[a(R,{type:"textarea",modelValue:d.value.content,"onUpdate:modelValue":o[5]||(o[5]=s=>d.value.content=s),placeholder:n(e)("contentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});const ta=ge(Ne,[["__scopeId","data-v-fb56fac6"]]);export{ta as default};
