import{d as K,n as M,r as C,f as Q,s as $,h as f,c as w,a as r,F as V,G as T,A as R,t as u,y as g,z as v,u as n,N as s,e as i,w as d,i as _,R as Z,B as S,I,a4 as E,U as ee,W as te,E as le,X as ae,aC as oe,aD as se,Y as ie,aa as pe,_ as ne}from"./index-9d601459.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                  */import{b as re,c as de,d as ue}from"./diy-7134d17c.js";const me={class:"flex flex-wrap"},ce={class:"absolute top-[46px] left-[50%] translate-x-[-50%] text-[14px] truncate w-[130px] text-center"},fe={class:"w-[282px] h-[493px] mx-auto"},_e=["id","src"],ge={class:"w-[282px] h-[493px] mx-auto bg-body pt-[20px] px-[20px]"},ve={class:"font-bold text-xl mb-[40px]"},xe={class:"mb-[20px] flex flex-col"},we={class:"mb-[10px]"},ye={class:"flex"},he={class:"overflow-hidden w-[282px] h-[493px] mx-auto"},be=["src"],De={class:"text-[12px] text-[#999] mt-[10px] mx-auto truncate text-center w-[250px]"},Pe={class:"item-btn-box absolute top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%] flex flex-col flex-wrap"},Ve={class:"text-primary px-[5px]"},ke={class:"mt-[10px]"},Ce={class:"dialog-footer"},Te=K({__name:"index",setup(Ie){const a=M({}),b=C(!1),U=Q(),c=C("template"),D=C(""),t=M({type:"",name:"",mode:"",template:"",id:"",page:"",title:"",action:""}),B=()=>{t.type="",t.name="",t.mode="",t.template="",t.id="",t.page="",t.title="",t.action="",re({}).then(l=>{for(let e in l.data)a[e]=l.data[e];for(let e in a)a[e].use_template.url&&(a[e].loadingIframe=!1,a[e].loadingDev=!1,a[e].isDisabledPop=!1,a[e].difference=0,D.value=a[e].domain_url.wap_domain,a[e].wapUrl=a[e].domain_url.wap_url,L(e))})};B(),window.addEventListener("message",l=>{try{let p=JSON.parse(l.data);if(["appOnLaunch","appOnReady"].indexOf(p.type)!=-1)for(let m in a){a[m].loadingDev=!1,a[m].loadingIframe=!0;var e=new Date().getTime();a[m].difference=e-a[m].timeIframe,a[m].isDisabledPop=!1}}catch(p){for(let m in a)N(m);console.log("后台接受数据错误",p)}},!1);const F=l=>{var e=JSON.stringify({type:"appOnReady",message:"加载完成"});window["previewIframe_"+l]&&window["previewIframe_"+l].contentWindow.postMessage(e,"*")},N=l=>{a[l].loadingDev=!0,a[l].isDisabledPop=!0,a[l].loadingIframe=!1},q=()=>{if(D.value.trim().length==0){E({type:"warning",message:`${s("wapDomainPlaceholder")}`});return}let l=D.value+"/wap";ee.set({key:"wap_domain",data:l});for(let e in a)a[e].use_template.url&&(a[e].wapUrl=l,L(e));setTimeout(()=>{for(let e in a)a[e].use_template.url&&(a[e].loadingIframe=!0,a[e].loadingDev=!1,a[e].isDisabledPop=!1)},100*3)},z=()=>{window.open("https://www.kancloud.cn/niucloud/niucloud-admin-develop/3213393")},L=l=>{a[l].use_template.wapPreview=a[l].wapUrl+a[l].use_template.url,a[l].timeIframe=new Date().getTime(),F(l),setTimeout(()=>{a[l].difference==0&&N(l)},1e3*2)},A=(l,e)=>{b.value=!0,c.value=e.use_template.hope,t.type=l,t.name=e.use_template.name,t.mode=e.use_template.mode,t.action=e.use_template.action,c.value=="template"?t.template=e.use_template.template:c.value=="diy"?t.id=e.use_template.id:c.value=="other"&&(t.page=e.use_template.page,t.title=e.use_template.title)},J=l=>{let e={back:"/site/diy/index"};l.id?e.id=l.id:l.name?e.name=l.name:l.url&&(e.url=l.url);let p=U.resolve({path:"/decorate/edit",query:e});window.open(p.href)},W=l=>{let e=l.page;l.url?e=l.url:l.id&&(e+="?id="+l.id);let p=U.resolve({path:"/preview/wap",query:{page:e}});window.open(p.href)},j=l=>{let e=U.resolve({path:"/diy/list"});window.open(e.href)},G=()=>{de({type:t.type}).then(l=>{let e=!0;for(let p=0;p<l.data.length;p++)if(t.id==l.data[p].id){e=!1;break}e&&(t.id=""),a[t.type].my_page={},Object.assign(a[t.type].my_page,l.data)})};$(()=>c.value,(l,e)=>{l=="template"?(t.id="",t.page="",t.action="decorate",t.name=t.type):l=="diy"?(t.mode="diy",t.template="",t.page="",t.action="decorate",t.name=t.type):l=="other"&&(t.mode="other",t.template="",t.id="")}),$(()=>t.template,(l,e)=>{l&&(t.mode=a[t.type].template[l].mode)}),$(()=>t.page,(l,e)=>{if(l){for(let p=0;p<a[t.type].other_page.length;p++)if(a[t.type].other_page[p].page==l){t.name=a[t.type].other_page[p].name,t.title=a[t.type].other_page[p].title,t.action=a[t.type].other_page[p].action;break}}});const O=C(!1),X=()=>{if(c.value=="template"){if(t.template==""){E({type:"warning",message:`${s("placeholderTemplate")}`});return}}else if(c.value=="diy"){if(t.id==""){E({type:"warning",message:`${s("placeholderMyPage")}`});return}}else if(c.value=="other"&&t.page==""){E({type:"warning",message:`${s("placeholderOtherPage")}`});return}O.value||(O.value=!0,ue({...t}).then(l=>{O.value=!1,b.value=!1,B()}))};return(l,e)=>{const p=te,m=le,P=ae,y=oe,k=se,Y=ie,H=pe;return f(),w(V,null,[r("div",me,[(f(!0),w(V,null,T(a,(o,x)=>(f(),w("div",{class:R(["page-item relative bg-no-repeat ml-[20px] mr-[40px] mt-[20px] bg-[#f7f7f7] w-[300px] pt-[80px] pb-[20px]",{"cursor-pointer":!o.isDisabledPop}]),key:x},[r("p",ce,u(o.use_template.title),1),g(r("div",fe,[g(r("iframe",{id:"previewIframe_"+x,class:"w-[282px] h-[493px] mx-auto",src:o.use_template.wapPreview,frameborder:"0"},null,8,_e),[[v,o.loadingIframe]]),g(r("div",ge,[r("div",ve,u(n(s)("developTitle")),1),r("div",xe,[r("text",we,u(n(s)("wapDomain")),1),i(p,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=h=>D.value=h),placeholder:n(s)("wapDomainPlaceholder"),clearable:""},null,8,["modelValue","placeholder"])]),r("div",ye,[i(m,{type:"primary",onClick:e[1]||(e[1]=h=>q())},{default:d(()=>[_(u(n(s)("confirm")),1)]),_:1}),i(m,{type:"primary",onClick:e[2]||(e[2]=h=>z()),plain:""},{default:d(()=>[_(u(n(s)("settingTips")),1)]),_:1})])],512),[[v,o.loadingDev]])],512),[[v,o.use_template.url]]),g(r("div",he,[o.use_template.cover?(f(),w("img",{key:0,class:"max-w-full",src:n(Z)(o.use_template.cover)},null,8,be)):S("",!0)],512),[[v,!o.use_template.wapPreview]]),r("p",De,u(o.use_template.desc),1),r("div",{class:R(["item-hide absolute inset-x-0 inset-y-0 bg-black bg-opacity-50 text-center",{disabled:o.isDisabledPop}])},[r("div",Pe,[i(m,{onClick:h=>A(x,o)},{default:d(()=>[_(u(n(s)("changePage")),1)]),_:2},1032,["onClick"]),g(i(m,{onClick:h=>J(o.use_template)},{default:d(()=>[_(u(n(s)("decorate")),1)]),_:2},1032,["onClick"]),[[v,o.use_template.mode!="other"||o.use_template.action=="decorate"]]),i(m,{onClick:h=>W(o.use_template)},{default:d(()=>[_(u(n(s)("preview")),1)]),_:2},1032,["onClick"])])],2)],2))),128))]),i(H,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=o=>b.value=o),title:n(s)("changeTemplate"),width:"400px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:d(()=>[r("span",Ce,[i(m,{onClick:e[7]||(e[7]=o=>b.value=!1)},{default:d(()=>[_(u(n(s)("cancel")),1)]),_:1}),i(m,{type:"primary",onClick:X},{default:d(()=>[_(u(n(s)("confirm")),1)]),_:1})])]),default:d(()=>[t.type?(f(),I(Y,{key:0,model:l.form,"label-width":"0px"},{default:d(()=>[i(P,{label:""},{default:d(()=>[r("div",null,[_(u(n(s)("hopeBeforeTip")),1),r("span",Ve,u(a[t.type].title),1),_(u(n(s)("hopeAfterTip")),1)])]),_:1}),i(P,{label:""},{default:d(()=>[i(k,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),class:"w-full"},{default:d(()=>[i(y,{label:n(s)("changeTemplateTip")+" "+a[t.type].title+" "+n(s)("template"),value:"template"},null,8,["label"]),i(y,{label:n(s)("changeMyPageTip")+" "+a[t.type].title,value:"diy"},null,8,["label"]),i(y,{label:n(s)("changeOtherPageTip")+" "+a[t.type].title,value:"other"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),g(i(P,{label:""},{default:d(()=>[i(k,{modelValue:t.template,"onUpdate:modelValue":e[4]||(e[4]=o=>t.template=o),class:"w-full"},{default:d(()=>[(f(!0),w(V,null,T(a[t.type].template,(o,x)=>(f(),I(y,{label:o.title,value:x},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1},512),[[v,c.value=="template"]]),g(i(P,{label:""},{default:d(()=>[i(k,{modelValue:t.id,"onUpdate:modelValue":e[5]||(e[5]=o=>t.id=o),class:"w-full"},{default:d(()=>[(f(!0),w(V,null,T(a[t.type].my_page,(o,x)=>(f(),I(y,{label:o.title,value:o.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"]),r("div",ke,[r("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:j},u(n(s)("createPage")),1),r("span",{class:"cursor-pointer text-primary",onClick:G},u(n(s)("refreshPage")),1)])]),_:1},512),[[v,c.value=="diy"]]),g(i(P,{label:""},{default:d(()=>[i(k,{modelValue:t.page,"onUpdate:modelValue":e[6]||(e[6]=o=>t.page=o),class:"w-full"},{default:d(()=>[(f(!0),w(V,null,T(a[t.type].other_page,(o,x)=>(f(),I(y,{label:o.title,value:o.page},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1},512),[[v,c.value=="other"]])]),_:1},8,["model"])):S("",!0)]),_:1},8,["modelValue","title"])],64)}}});const ze=ne(Te,[["__scopeId","data-v-14185b9f"]]);export{ze as default};
