import{d as P,r,O as F,n as W,aL as z,s as J,a4 as h,N as e,h as w,c as S,a as t,y as g,z as y,t as c,u as o,e as s,w as l,i as B,I as T,R as M,B as X,U as Y,W as j,E as A,X as G,V as H,Y as K}from"./index-9d601459.js";/* empty css                *//* empty css                 *//* empty css                        */import"./el-form-item-4ed993c7.js";/* empty css                  *//* empty css                 */import{g as Q}from"./weapp-37d6496a.js";import{m as Z}from"./sys-45a56363.js";import{b as ee}from"./browser-a1ac24ac.js";const ae={class:"main-container w-[375px] mx-auto mt-[20px] mb-[40px] relative"},te={class:"flex full-container"},oe=["src"],se={class:"w-[375px] border border-slate-100 bg-body pt-[20px] px-[20px]"},le={class:"font-bold text-xl mb-[40px]"},ne={class:"mb-[20px] flex flex-col"},pe={class:"mb-[10px]"},re={key:0,class:"w-[400px] absolute bg-body top-[10%] -right-[450px]"},ce={class:"info-wrap mt-[20px]"},ie={class:"px-[20px] pb-[10px] font-bold"},ue={class:"px-[20px] pb-[10px] font-bold mt-[40px]"},de={class:"text-gray-400"},ke=P({__name:"preview",setup(me){const d=r(""),m=r(""),_=r(""),n=r(""),u=r(!1),v=r(!1),D=r(0),k=r(0);new Date().getTime();const f=F();f.query.page=f.query.page||"",Z().then(a=>{d.value=a.data.wap_url,C()});const O=()=>{if(m.value.trim().length==0){h({type:"warning",message:`${e("wapDomainPlaceholder")}`});return}d.value=m.value+"/wap",C(),Y.set({key:"wap_domain",data:d.value}),u.value=!0,v.value=!1},C=()=>{f.query.page&&(n.value=`${d.value}${f.query.page}`,console.log(n.value),ee.toDataURL(n.value,{errorCorrectionLevel:"L",margin:0,width:100}).then(a=>{_.value=a}),D.value=new Date().getTime(),setTimeout(()=>{k.value==0&&E()},1e3*2))};window.addEventListener("message",a=>{try{let i=JSON.parse(a.data);if(["appOnLaunch","appOnReady"].indexOf(i.type)!=-1){v.value=!1,u.value=!0;var p=new Date().getTime();k.value=p-D.value}}catch(i){E(),console.log("后台接受数据错误",i)}},!1);const E=()=>{v.value=!0,u.value=!1,n.value="",_.value=""},b=W({qr_code:""});Q().then(a=>{if(a.code==1){let p=a.data;b.qr_code=p.qr_code}});const{copy:U,isSupported:R,copied:q}=z(),$=a=>{R.value||h({message:e("notSupportCopy"),type:"warning"}),U(a)};return J(q,()=>{q.value&&h({message:e("copySuccess"),type:"success"})}),(a,p)=>{const i=j,I=A,x=G,V=H,L=K;return w(),S("div",ae,[t("div",te,[g(t("iframe",{class:"w-[375px]",src:n.value,frameborder:"0",id:"previewIframe"},null,8,oe),[[y,u.value]]),g(t("div",se,[t("div",le,c(o(e)("developTitle")),1),t("div",ne,[t("text",pe,c(o(e)("wapDomain")),1),s(i,{modelValue:m.value,"onUpdate:modelValue":p[0]||(p[0]=N=>m.value=N),placeholder:o(e)("wapDomainPlaceholder"),clearable:""},null,8,["modelValue","placeholder"])]),s(I,{type:"primary",onClick:O},{default:l(()=>[B(c(o(e)("confirm")),1)]),_:1})],512),[[y,v.value]]),u.value?(w(),S("div",re,[t("div",ce,[t("div",ie,c(o(e)("h5")),1),s(L,{"label-width":"40px",class:"px-[20px]"},{default:l(()=>[g(s(x,{label:o(e)("link")},{default:l(()=>[s(i,{readonly:"",value:n.value},{append:l(()=>[s(I,{onClick:p[1]||(p[1]=N=>$(n.value)),class:"bg-primary copy"},{default:l(()=>[B(c(o(e)("copy")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),[[y,n.value]]),g(s(x,{label:" "},{default:l(()=>[s(V,{src:_.value},null,8,["src"])]),_:1},512),[[y,_.value]])]),_:1}),t("div",ue,c(o(e)("weapp")),1),s(L,{"label-width":"40px",class:"px-[20px]"},{default:l(()=>[b.qr_code?(w(),T(x,{key:0,label:" "},{default:l(()=>[s(V,{class:"w-[100px] h-[100px]",src:o(M)(b.qr_code)},null,8,["src"])]),_:1})):(w(),T(x,{key:1,label:" "},{default:l(()=>[t("span",de,c(o(e)("weappNotSet")),1)]),_:1}))]),_:1})])])):X("",!0)])])}}});export{ke as default};
