import{d as ee,K as te,q as ae,r as _,n as I,f as se,aK as le,s as oe,a3 as C,N as l,h as f,c as g,a as s,t as i,y as w,z as y,u as o,e as r,w as d,i as m,R as ne,B as E,A as L,I as ie,F as N,G as pe,U as re,W as de,E as ce,X as me,Y as ue,V as _e,ap as fe,aa as ve}from"./index-4ce69858.js";/* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                  *//* empty css                 */import{h as xe,c as ge,d as we}from"./diy-2247a3d0.js";import{b as ye}from"./browser-a1ac24ac.js";import{_ as he}from"./_plugin-vue_export-helper-c27b6911.js";const be={key:0,class:"flex flex-wrap mt-[20px] min-w-[1000px]"},De={class:"page-item relative bg-no-repeat ml-[20px] mr-[40px] bg-[#f7f7f7] w-[340px] pt-[90px] pb-[20px]"},ke={class:"absolute top-[54px] left-[50%] translate-x-[-50%] text-[14px] truncate w-[130px] text-center"},Ie={class:"w-[320px] h-[550px] mx-auto"},Ce=["id","src"],Ee={class:"w-[320px] h-[550px] mx-auto bg-body pt-[20px] px-[20px]"},Pe={class:"font-bold text-xl mb-[40px]"},Ue={class:"mb-[20px] flex flex-col"},Te={class:"mb-[10px]"},Se={class:"flex"},Ve={class:"overflow-hidden w-[320px] h-[550px] mx-auto"},$e=["src"],Re={class:"w-[500px]"},Le={class:"flex flex-wrap"},Ne={class:"info-wrap"},Be={class:"mt-[20px] bg-[#F7F8FA] p-[20px] flex items-center justify-between"},Fe={class:"font-bold"},Oe={class:"text-[#999] text-base"},Me={class:"text-center"},qe={class:"flex items-start"},Ae={class:"flex flex-wrap"},ze=["onClick"],Je={class:"dialog-footer"},Ke=ee({__name:"member",setup(We){const B=te(),F=ae(()=>B.siteInfo.apps),h=_("DIY_MEMBER_INDEX"),e=I({}),P=se(),v=_(""),U=_(""),p=_({name:""}),u=I({type:"",name:"",page:"",title:"",action:""}),x=_(!1),T=I({});xe({type:"member_index"}).then(a=>{for(const t in a.data)T[t]=a.data[t]});const S=()=>{ge({type:h.value}).then(a=>{for(const t in a.data)e[t]=a.data[t];p.value.name=e.use_template.name,p.value.title=e.use_template.title,p.value.page=e.use_template.page,p.value.action=e.use_template.action,e.use_template.url&&(e.loadingIframe=!1,e.loadingDev=!1,e.isDisabledPop=!1,e.difference=0,v.value=e.domain_url.wap_domain,e.wapUrl=e.domain_url.wap_url,$())})};S(),window.addEventListener("message",a=>{try{const t=JSON.parse(a.data);if(["appOnLaunch","appOnReady"].indexOf(t.type)!=-1){e.loadingDev=!1,e.loadingIframe=!0;const b=new Date().getTime();e.difference=b-e.timeIframe,e.isDisabledPop=!1}}catch(t){V(),console.log("后台接受数据错误",t)}},!1);const O=()=>{const a=JSON.stringify({type:"appOnReady",message:"加载完成"});window["previewIframe_"+h.value]&&window["previewIframe_"+h.value].contentWindow.postMessage(a,"*")},V=()=>{e.loadingDev=!0,e.isDisabledPop=!0,e.loadingIframe=!1},M=()=>{if(v.value.trim().length==0){C({type:"warning",message:`${l("wapDomainPlaceholder")}`});return}const a=v.value+"/wap";re.set({key:"wap_domain",data:a}),e.use_template.url&&(e.wapUrl=a,$()),setTimeout(()=>{e.use_template.url&&(e.loadingIframe=!0,e.loadingDev=!1,e.isDisabledPop=!1)},100*3)},q=()=>{window.open("https://www.kancloud.cn/niucloud/niucloud-admin-develop/3213393")},$=()=>{e.use_template.wapPreview=e.wapUrl+e.use_template.url,e.shareUrl=e.wapUrl+e.page,ye.toDataURL(e.shareUrl,{errorCorrectionLevel:"L",margin:0,width:100}).then(a=>{U.value=a}),e.timeIframe=new Date().getTime(),O(),setTimeout(()=>{e.difference==0&&V()},1e3*2)},A=()=>{const a={back:"/site/diy/member"};e.use_template.id?a.id=e.use_template.id:e.use_template.type?a.name=e.use_template.type:e.use_template.url&&(a.url=e.use_template.url);const t=P.resolve({path:"/decorate/edit",query:a});window.open(t.href)},z=()=>{let a=e.use_template.page;e.use_template.url?a=e.use_template.url:e.use_template.id&&(a+="?id="+e.use_template.id);const t=P.resolve({path:"/preview/wap",query:{page:a}});window.open(t.href)},J=(a,t)=>{p.value.name=a,p.value.page=t.page,p.value.title=t.title,p.value.action=t.action},D=_(!1),K=()=>{u.type=h.value,u.name=p.value.name,u.page=p.value.page,u.title=p.value.title,u.action=p.value.action,!D.value&&(D.value=!0,we({...u}).then(a=>{D.value=!1,x.value=!1,S()}))},{copy:W,isSupported:X,copied:R}=le(),Y=a=>{X.value||C({message:l("notSupportCopy"),type:"warning"}),W(a)};return oe(R,()=>{R.value&&C({message:l("copySuccess"),type:"success"})}),(a,t)=>{const b=de,c=ce,j=me,G=ue,H=_e,Q=fe,Z=ve;return f(),g(N,null,[e.use_template?(f(),g("div",be,[s("div",De,[s("p",ke,i(e.use_template.title),1),w(s("div",Ie,[w(s("iframe",{id:"previewIframe_"+a.key,class:"w-[320px] h-[550px] mx-auto",src:e.use_template.wapPreview,frameborder:"0"},null,8,Ce),[[y,e.loadingIframe]]),w(s("div",Ee,[s("div",Pe,i(o(l)("developTitle")),1),s("div",Ue,[s("text",Te,i(o(l)("wapDomain")),1),r(b,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=n=>v.value=n),placeholder:o(l)("wapDomainPlaceholder"),clearable:""},null,8,["modelValue","placeholder"])]),s("div",Se,[r(c,{type:"primary",onClick:t[1]||(t[1]=n=>M())},{default:d(()=>[m(i(o(l)("confirm")),1)]),_:1}),r(c,{type:"primary",onClick:t[2]||(t[2]=n=>q()),plain:""},{default:d(()=>[m(i(o(l)("settingTips")),1)]),_:1})])],512),[[y,e.loadingDev]])],512),[[y,e.use_template.url]]),w(s("div",Ve,[e.use_template.cover?(f(),g("img",{key:0,class:"max-w-full",src:o(ne)(e.use_template.cover)},null,8,$e)):E("",!0)],512),[[y,!e.use_template.wapPreview]]),s("div",{class:L(["popup-wrap absolute inset-x-0 inset-y-0 select-none",{disabled:e.isDisabledPop}])},null,2)]),s("div",Re,[s("div",Le,[o(F).length>1?(f(),ie(c,{key:0,type:"primary",onClick:t[3]||(t[3]=n=>x.value=!0)},{default:d(()=>[m(i(o(l)("changePage")),1)]),_:1})):E("",!0),w(r(c,{type:"primary",onClick:t[4]||(t[4]=n=>A()),class:"ml-[12px]"},{default:d(()=>[m(i(o(l)("decorate")),1)]),_:1},512),[[y,e.use_template.action=="decorate"]])]),s("div",Ne,[s("div",Be,[s("div",null,[s("div",Fe,i(o(l)("H5")),1),r(G,{"label-width":"40px",class:"mt-[5px]"},{default:d(()=>[r(j,{label:o(l)("link"),class:"mb-[5px]"},{default:d(()=>[r(b,{readonly:"",value:e.shareUrl},{append:d(()=>[r(c,{onClick:t[5]||(t[5]=n=>Y(e.shareUrl)),class:"bg-primary copy"},{default:d(()=>[m(i(o(l)("copy")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),s("div",Oe,i(o(l)("scanQRCodeOnRight")),1)]),s("div",Me,[r(H,{class:"w-[100px] h-[100px] mb-[5px]",src:U.value},null,8,["src"]),s("div",{onClick:t[6]||(t[6]=n=>z()),class:"text-primary text-base cursor-pointer"},i(o(l)("preview")),1)])])])])])):E("",!0),r(Z,{modelValue:x.value,"onUpdate:modelValue":t[9]||(t[9]=n=>x.value=n),title:o(l)("pageSelectTips"),width:"400px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:d(()=>[s("span",Je,[r(c,{onClick:t[7]||(t[7]=n=>x.value=!1)},{default:d(()=>[m(i(o(l)("cancel")),1)]),_:1}),r(c,{type:"primary",onClick:t[8]||(t[8]=n=>K())},{default:d(()=>[m(i(o(l)("confirm")),1)]),_:1})])]),default:d(()=>[s("div",qe,[r(Q,{class:"pl-4 h-[300px] flex-1"},{default:d(()=>[s("div",Ae,[(f(!0),g(N,null,pe(T,(n,k)=>(f(),g("div",{key:k,class:L(["border border-br rounded-[3px] mr-[10px] mb-[10px] px-4 h-[32px] leading-[32px] cursor-pointer hover:bg-primary-light-9 px-[10px] hover:text-primary",[k==p.value.name?"border-primary text-primary":""]]),onClick:Xe=>J(k,n)},i(n.title),11,ze))),128))])]),_:1})])]),_:1},8,["modelValue","title"])],64)}}});const nt=he(Ke,[["__scopeId","data-v-20a9abe7"]]);export{nt as default};
