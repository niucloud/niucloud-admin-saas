import{d as te,O as le,f as oe,r as p,n as ne,h as w,c as I,a as r,t as c,u as n,e as a,w as i,N as e,i as m,y as se,I as P,B as L,a8 as B,aC as ie,aD as pe,E as ce,ah as de,ai as ue,aj as re,a4 as me,_ as _e,W as fe,X as ge,Y as he,aa as ve,ap as be,$ as we}from"./index-30b146d4.js";/* empty css                   *//* empty css                     *//* empty css                   *//* empty css                     */import{_ as xe}from"./index.vue_vue_type_style_index_0_lang-601cba9c.js";/* empty css                 *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                    */import{g as Ve,a as Ce,b as ye,s as Te,c as Ee}from"./weapp-b0208463.js";import{a as ke}from"./module-dec1fba2.js";import{_ as Be}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                    */const Re={class:"main-container min-h-[300px] p-5"},Ue={class:"flex justify-between items-center mb-[20px]"},De={class:"text-page-title"},We={class:"mt-[50px]"},ze={key:0,class:""},Fe={class:"mt-[16px] flex justify-end"},Ne={class:"dialog-footer"},Ie=te({__name:"code",setup(Pe){const $=le(),x=oe(),j=$.meta.title,V=p(!1),s=ne({page:1,limit:10,total:0,loading:!1,data:[]}),d=p({desc:"",code:"",path:"",content:""}),C=p("");ke().then(l=>{l.data.data&&l.data.data.auth_code&&(C.value=l.data.data.auth_code,T())}).catch(()=>{});const R=p({app_id:"",app_secret:""});Ve().then(l=>{R.value=l.data});const y=p("/channel/weapp/code"),M=l=>{x.push({path:y.value})},U=p(null),_=(l=1)=>{s.loading=!0,s.page=l,ye({page:s.page,limit:s.limit}).then(t=>{s.loading=!1,s.data=t.data.data,s.total=t.data.total,l==1&&s.data.length&&s.data[0].status==0&&W(s.data[0].task_key)}).catch(()=>{s.loading=!1})};_();const S=()=>{U.value.clearValidate()},g=p(!1),D=()=>{if(!C.value){O();return}if(!R.value.app_id){X();return}g.value||(g.value=!0,v.value="",Te(d.value).then(l=>{_(),T(),g.value=!1}).catch(()=>{g.value=!1}))},A=()=>{B.alert(e("localInsertTips"),e("warning"),{confirmButtonText:e("confirm")})},v=p(""),T=()=>{C.value&&Ce().then(l=>{l.data&&(v.value=`<img src="${l.data}" class="w-[150px]">`)}).catch()},W=l=>{Ee(l).then(t=>{const u=t.data.data??[];if(u[0]&&u[0].length){const h=u[0][u[0].length-1];if(h.code==0){_();return}if(h.code==1&&h.percent==100){_(),T();return}setTimeout(()=>{W(l)},2e3)}})},O=()=>{B.confirm(e("authTips"),e("warning"),{distinguishCancelAndClose:!0,confirmButtonText:e("toBind"),cancelButtonText:e("toNiucloud")}).then(()=>{x.push({path:"/app/authorize"})}).catch(l=>{l==="cancel"&&window.open("https://www.niucloud.com/app")})},X=()=>{B.confirm(e("weappTips"),e("warning"),{confirmButtonText:e("toSetting"),cancelButtonText:e("cancel")}).then(()=>{x.push({path:"/channel/weapp/config"})}).catch(l=>{})},z=p(""),E=p(!1),Y=l=>{z.value=l.fail_reason,E.value=!0};return(l,t)=>{const u=ie,h=pe,f=ce,b=de,q=ue,G=re,H=me,J=_e,F=fe,k=ge,K=xe,Q=he,N=ve,Z=be,ee=we;return w(),I("div",Re,[r("div",Ue,[r("span",De,c(n(j)),1)]),a(h,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),class:"demo-tabs",onTabChange:M},{default:i(()=>[a(u,{label:n(e)("weappAccessFlow"),name:"/channel/weapp"},null,8,["label"]),a(u,{label:n(e)("subscribeMessage"),name:"/channel/weapp/message"},null,8,["label"]),a(u,{label:n(e)("weappRelease"),name:"/channel/weapp/code"},null,8,["label"])]),_:1},8,["modelValue"]),a(J,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[r("div",We,[a(f,{type:"primary",onClick:D,loading:g.value,disabled:s.loading},{default:i(()=>[m(c(n(e)("cloudRelease")),1)]),_:1},8,["loading","disabled"]),a(f,{onClick:A,disabled:s.loading},{default:i(()=>[m(c(n(e)("localRelease")),1)]),_:1},8,["disabled"])]),se((w(),P(G,{class:"mt-[15px]",data:s.data,size:"default"},{empty:i(()=>[r("span",null,c(n(e)("emptyData")),1)]),default:i(()=>[a(b,{prop:"version",label:n(e)("code"),align:"left"},null,8,["label"]),a(b,{prop:"status_name",label:n(e)("status"),align:"left"},{default:i(({row:o})=>[r("div",null,c(o.status_name),1)]),_:1},8,["label"]),a(b,{prop:"create_time",label:n(e)("createTime"),align:"center"},null,8,["label"]),a(b,{label:n(e)("operation"),fixed:"right",align:"right","min-width":"120"},{default:i(({row:o,$index:ae})=>[v.value&&ae==0&&o.status==1&&s.page==1?(w(),I("div",ze,[a(q,{content:v.value,"raw-content":"",effect:"light"},{default:i(()=>[a(f,{type:"primary",link:""},{default:i(()=>[m(c(n(e)("preview")),1)]),_:1})]),_:1},8,["content"]),o.status==-1?(w(),P(f,{key:0,type:"primary",link:"",onClick:Le=>Y(o)},{default:i(()=>[m(c(n(e)("failReason")),1)]),_:2},1032,["onClick"])):L("",!0)])):L("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[ee,s.loading]]),r("div",Fe,[a(H,{"current-page":s.page,"onUpdate:current-page":t[1]||(t[1]=o=>s.page=o),"page-size":s.limit,"onUpdate:page-size":t[2]||(t[2]=o=>s.limit=o),layout:"total, sizes, prev, pager, next, jumper",total:s.total,onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])])]),_:1}),a(N,{modelValue:V.value,"onUpdate:modelValue":t[7]||(t[7]=o=>V.value=o),title:n(e)("codeDownTwoDesc"),width:"30%","before-close":S},{footer:i(()=>[r("span",Ne,[a(f,{onClick:t[6]||(t[6]=o=>V.value=!1)},{default:i(()=>[m(c(n(e)("cancel")),1)]),_:1}),a(f,{type:"primary",onClick:D},{default:i(()=>[m(c(n(e)("confirm")),1)]),_:1})])]),default:i(()=>[a(Q,{ref_key:"ruleFormRef",ref:U,model:d.value,"label-width":"120px"},{default:i(()=>[a(k,{prop:"code",label:n(e)("code")},{default:i(()=>[a(F,{modelValue:d.value.code,"onUpdate:modelValue":t[3]||(t[3]=o=>d.value.code=o),placeholder:n(e)("codePlaceholder"),onkeyup:"this.value = this.value.replace(/[^\\d\\.]/g,'');"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(k,{prop:"path",label:n(e)("path")},{default:i(()=>[a(K,{modelValue:d.value.path,"onUpdate:modelValue":t[4]||(t[4]=o=>d.value.path=o),api:"weapp/upload",accept:".zip"},null,8,["modelValue","accept"])]),_:1},8,["label"]),a(k,{label:n(e)("content")},{default:i(()=>[a(F,{type:"textarea",modelValue:d.value.content,"onUpdate:modelValue":t[5]||(t[5]=o=>d.value.content=o),placeholder:n(e)("contentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(N,{modelValue:E.value,"onUpdate:modelValue":t[8]||(t[8]=o=>E.value=o),title:n(e)("failReason"),width:"60%"},{default:i(()=>[a(Z,{class:"h-[60vh] w-full whitespace-pre p-[20px]"},{default:i(()=>[m(c(z.value),1)]),_:1})]),_:1},8,["modelValue","title"])])}}});const ia=Be(Ie,[["__scopeId","data-v-2af58e39"]]);export{ia as default};
