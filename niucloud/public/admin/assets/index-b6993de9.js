import{d as J,r as v,n as E,f as K,aK as W,s as X,a3 as h,N as l,h as V,c as T,a as s,t as n,y as u,z as c,u as o,e as p,w as r,i as w,R as j,B as N,A as H,U as Q,W as G,E as Z,X as ee,Y as te,V as ae}from"./index-b19d04dd.js";/* empty css                 *//* empty css                        *//* empty css                */import"./el-form-item-4ed993c7.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-2b63d573.js";/* empty css                  *//* empty css                 */import{c as le,d as oe}from"./diy-f74720de.js";import{b as ie}from"./browser-a1ac24ac.js";import{_ as ne}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                   *//* empty css                     *//* empty css                */const pe={key:0,class:"flex flex-wrap mt-[20px] min-w-[1000px]"},re={class:"page-item relative bg-no-repeat ml-[20px] mr-[40px] bg-[#f7f7f7] w-[340px] pt-[90px] pb-[20px]"},me={class:"absolute top-[54px] left-[50%] translate-x-[-50%] text-[14px] truncate w-[130px] text-center"},de={class:"w-[320px] h-[550px] mx-auto"},ue=["id","src"],ce={class:"w-[320px] h-[550px] mx-auto bg-body pt-[20px] px-[20px]"},_e={class:"font-bold text-xl mb-[40px]"},fe={class:"mb-[20px] flex flex-col"},ve={class:"mb-[10px]"},we={class:"flex"},xe={class:"overflow-hidden w-[320px] h-[550px] mx-auto"},ge=["src"],ye={class:"w-[500px]"},he={class:"flex flex-wrap"},be={class:"info-wrap"},De={class:"mt-[20px] bg-[#F7F8FA] p-[20px] flex items-center justify-between"},Ie={class:"font-bold"},Pe={class:"text-[#999] text-base"},ke={class:"text-center"},Ce=J({__name:"index",setup(Ee){const x=v("DIY_INDEX"),e=E({}),b=K(),_=v(""),D=v(""),i=v({name:""}),d=E({type:"",name:"",parent:"",page:"",title:"",action:""}),I=()=>{le({type:x.value}).then(t=>{for(const a in t.data)e[a]=t.data[a];i.value.name=e.use_template.name,i.value.title=e.use_template.title,i.value.page=e.use_template.page,i.value.action=e.use_template.action,i.value.parent=e.use_template.parent,e.use_template.url&&(e.loadingIframe=!1,e.loadingDev=!1,e.isDisabledPop=!1,e.difference=0,_.value=e.domain_url.wap_domain,e.wapUrl=e.domain_url.wap_url,k())})};I(),window.addEventListener("message",t=>{try{const a=JSON.parse(t.data);if(["appOnLaunch","appOnReady"].indexOf(a.type)!=-1){e.loadingDev=!1,e.loadingIframe=!0;const g=new Date().getTime();e.difference=g-e.timeIframe,e.isDisabledPop=!1}}catch(a){P(),console.log("后台接受数据错误",a)}},!1);const R=()=>{const t=JSON.stringify({type:"appOnReady",message:"加载完成"});window["previewIframe_"+x.value]&&window["previewIframe_"+x.value].contentWindow.postMessage(t,"*")},P=()=>{e.loadingDev=!0,e.isDisabledPop=!0,e.loadingIframe=!1},S=()=>{if(_.value.trim().length==0){h({type:"warning",message:`${l("wapDomainPlaceholder")}`});return}const t=_.value+"/wap";Q.set({key:"wap_domain",data:t}),e.use_template.url&&(e.wapUrl=t,k()),setTimeout(()=>{e.use_template.url&&(e.loadingIframe=!0,e.loadingDev=!1,e.isDisabledPop=!1)},100*3)},U=()=>{window.open("https://www.kancloud.cn/niucloud/niucloud-admin-develop/3213393")},k=()=>{e.use_template.wapPreview=e.wapUrl+e.use_template.url,ie.toDataURL(e.use_template.wapPreview,{errorCorrectionLevel:"L",margin:0,width:100}).then(t=>{D.value=t}),e.timeIframe=new Date().getTime(),R(),setTimeout(()=>{e.difference==0&&P()},1e3*2)},L=()=>{const t={back:"/site/diy/index"};e.use_template.id?t.id=e.use_template.id:e.use_template.type?t.name=e.use_template.type:e.use_template.url&&(t.url=e.use_template.url);const a=b.resolve({path:"/decorate/edit",query:t});window.open(a.href)},O=()=>{let t=e.use_template.page;e.use_template.url?t=e.use_template.url:e.use_template.id&&(t+="?id="+e.use_template.id);const a=b.resolve({path:"/preview/wap",query:{page:t}});window.open(a.href)},y=v(!1),$=()=>{d.type=x.value,d.name=i.value.name,d.page=i.value.url,d.title=i.value.title,d.action=i.value.action,d.parent=i.value.parent,!y.value&&(y.value=!0,oe({...d}).then(t=>{y.value=!1,I()}))},{copy:B,isSupported:F,copied:C}=W(),M=t=>{F.value||h({message:l("notSupportCopy"),type:"warning"}),B(t)};return X(C,()=>{C.value&&h({message:l("copySuccess"),type:"success"})}),(t,a)=>{const g=G,f=Z,Y=se,q=ee,z=te,A=ae;return e.use_template?(V(),T("div",pe,[s("div",re,[s("p",me,n(e.use_template.title),1),u(s("div",de,[u(s("iframe",{id:"previewIframe_"+t.key,class:"w-[320px] h-[550px] mx-auto",src:e.use_template.wapPreview,frameborder:"0"},null,8,ue),[[c,e.loadingIframe]]),u(s("div",ce,[s("div",_e,n(o(l)("developTitle")),1),s("div",fe,[s("text",ve,n(o(l)("wapDomain")),1),p(g,{modelValue:_.value,"onUpdate:modelValue":a[0]||(a[0]=m=>_.value=m),placeholder:o(l)("wapDomainPlaceholder"),clearable:""},null,8,["modelValue","placeholder"])]),s("div",we,[p(f,{type:"primary",onClick:a[1]||(a[1]=m=>S())},{default:r(()=>[w(n(o(l)("confirm")),1)]),_:1}),p(f,{type:"primary",onClick:a[2]||(a[2]=m=>U()),plain:""},{default:r(()=>[w(n(o(l)("settingTips")),1)]),_:1})])],512),[[c,e.loadingDev]])],512),[[c,e.use_template.url]]),u(s("div",xe,[e.use_template.cover?(V(),T("img",{key:0,class:"max-w-full",src:o(j)(e.use_template.cover)},null,8,ge)):N("",!0)],512),[[c,!e.use_template.wapPreview]]),s("div",{class:H(["popup-wrap absolute inset-x-0 inset-y-0 select-none",{disabled:e.isDisabledPop}])},null,2)]),s("div",ye,[s("div",he,[p(Y,{modelValue:i.value,"onUpdate:modelValue":a[3]||(a[3]=m=>i.value=m),ignore:["DIY_LINK"],onSuccess:$},{default:r(()=>[p(f,{type:"primary"},{default:r(()=>[w(n(o(l)("changePage")),1)]),_:1})]),_:1},8,["modelValue"]),u(p(f,{type:"primary",onClick:a[4]||(a[4]=m=>L()),class:"ml-[12px]"},{default:r(()=>[w(n(o(l)("decorate")),1)]),_:1},512),[[c,e.use_template.action=="decorate"]])]),s("div",be,[s("div",De,[s("div",null,[s("div",Ie,n(o(l)("H5")),1),p(z,{"label-width":"40px",class:"mt-[5px]"},{default:r(()=>[u(p(q,{label:o(l)("link"),class:"mb-[5px]"},{default:r(()=>[p(g,{readonly:"",value:e.use_template.wapPreview},{append:r(()=>[p(f,{onClick:a[5]||(a[5]=m=>M(e.use_template.wapPreview)),class:"bg-primary copy"},{default:r(()=>[w(n(o(l)("copy")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),[[c,e.use_template.wapPreview]])]),_:1}),s("div",Pe,n(o(l)("scanQRCodeOnRight")),1)]),s("div",ke,[p(A,{class:"w-[100px] h-[100px] mb-[5px]",src:D.value},null,8,["src"]),s("div",{onClick:a[6]||(a[6]=m=>O()),class:"text-primary text-base cursor-pointer"},n(o(l)("preview")),1)])])])])])):N("",!0)}}});const ze=ne(Ce,[["__scopeId","data-v-6b8cd127"]]);export{ze as default};
