import{d as X,r,R as Y,e as w,f as B,g as d,B as s,u as n,y as t,x as p,A as h,Q as Z,v as ee,H as F}from"./base-d79f9f62.js";/* empty css                   *//* empty css                   *//* empty css                */import{_ as te}from"./index.vue_vue_type_style_index_0_lang-9fd1bcaf.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                    */import{g as ae,a as oe,b as le,s as ne,c as ie}from"./weapp-96ac131c.js";import{t as e}from"./index-9e0d1e6c.js";import{u as pe,b as se}from"./vue-router-fc35ac55.js";import{g as re}from"./module-c4c1e190.js";import{E as k}from"./index-d1262e7a.js";import{a as me,E as ce}from"./index-3f47b227.js";import{E as de}from"./index-03649f16.js";import{a as ue,E as fe}from"./index-2b5d43b9.js";import{E as _e}from"./index-54a839cc.js";import{E as ge}from"./index-014848fe.js";import{E as he}from"./index-ba59a1dc.js";import{E as ve}from"./index-f249e665.js";import{a as be,E as we}from"./index-6befecc6.js";import{E as xe}from"./index-d0ada8fb.js";import{v as Ee}from"./directive-13582d99.js";import{_ as Ve}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                    */import"./storage-5316d819.js";import"./index-2048a34f.js";import"./index-3fd412a3.js";import"./index-542aa78e.js";import"./typescript-defaf979.js";import"./index-34cd7f55.js";import"./index-50edbf04.js";import"./error-78e43d3e.js";import"./index-6229e0fd.js";import"./index-6fcaf7b3.js";import"./pinia-55149fa9.js";import"./system-d23898e7.js";import"./index-5dbb8f83.js";import"./index-cf3a42e3.js";import"./scroll-aa5f3aa0.js";import"./vnode-772b0c47.js";import"./aria-adfa05c5.js";import"./focus-trap-50fa5770.js";import"./validator-8f1b170d.js";import"./index-71aec1df.js";import"./strings-d73e3c52.js";import"./event-9519ab40.js";import"./index-bdfee32a.js";import"./index-427f5a83.js";import"./index-2462875f.js";import"./_Uint8Array-bbbfd6ac.js";import"./_initCloneObject-a2c44136.js";import"./index-d4057e2a.js";import"./isEqual-3f50b221.js";import"./flatten-0bbd547a.js";import"./_isIterateeCall-559d3e90.js";import"./debounce-6fd93949.js";import"./index-af085fbd.js";import"./index-f3bad52c.js";import"./index-3a5faaeb.js";import"./index-b6ca69fd.js";const Ce={class:"main-container min-h-[300px] p-5"},ye={class:"flex justify-between items-center mb-[20px]"},Te={class:"text-[20px]"},Be={class:"mt-[50px]"},ke={key:0,class:"text-error"},Re={key:0,class:""},Ue={class:"mt-[16px] flex justify-end"},ze={class:"dialog-footer"},We=X({__name:"code",setup(De){const N=pe(),x=se(),I=N.meta.title;r("1");const E=r(!1),a=Y({page:1,limit:10,total:0,loading:!1,data:[]}),m=r({desc:""}),V=r("");re().then(o=>{o.data.data&&o.data.data.auth_code&&(V.value=o.data.data.auth_code,y())}).catch(()=>{});const R=r({});ae().then(o=>{R.value=o.data});const C=r("/channel/weapp/code"),P=o=>{x.push({path:C.value})},U=r(null),u=(o=1)=>{a.loading=!0,a.page=o,le({page:a.page,limit:a.limit}).then(l=>{a.loading=!1,a.data=l.data.data,a.total=l.data.total,o==1&&a.data.length&&a.data[0].status==0&&W(a.data[0].task_key)}).catch(()=>{a.loading=!1})};u();const L=()=>{U.value.clearValidate()},f=r(!1),z=()=>{if(!V.value){M();return}if(!R.value.app_id){j();return}f.value||(f.value=!0,v.value="",ne(m.value).then(o=>{u(),y(),f.value=!1}).catch(()=>{f.value=!1}))},A=()=>{k.alert(e("localInsertTips"),e("warning"),{confirmButtonText:e("confirm")})},v=r(""),y=()=>{V.value&&oe().then(o=>{o.data&&(v.value=`<img src="${o.data}" class="w-[150px]">`)}).catch()},W=o=>{ie(o).then(l=>{const c=l.data.data??[];if(c[0]&&c[0].length){const _=c[0][c[0].length-1];if(_.code==0){u();return}if(_.code==1&&_.percent==100){u(),y();return}setTimeout(()=>{W(o)},2e3)}})},M=()=>{k.confirm(e("authTips"),e("warning"),{distinguishCancelAndClose:!0,confirmButtonText:e("toBind"),cancelButtonText:e("toNiucloud")}).then(()=>{x.push({path:"/app/authorize"})}).catch(o=>{o==="cancel"&&window.open("https://www.niucloud.com/app")})},j=()=>{k.confirm(e("weappTips"),e("warning"),{confirmButtonText:e("toSetting"),cancelButtonText:e("cancel")}).then(()=>{x.push({path:"/channel/weapp/config"})}).catch(o=>{})};return(o,l)=>{const c=me,_=ce,g=de,b=ue,S=_e,$=fe,H=ge,Q=he,D=ve,T=be,q=te,G=we,J=xe,K=Ee;return w(),B("div",Ce,[d("div",ye,[d("span",Te,s(n(I)),1)]),t(_,{modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=i=>C.value=i),class:"demo-tabs",onTabChange:P},{default:p(()=>[t(c,{label:n(e)("weappAccessFlow"),name:"/channel/weapp"},null,8,["label"]),t(c,{label:n(e)("subscribeMessage"),name:"/channel/weapp/message"},null,8,["label"]),t(c,{label:n(e)("weappRelease"),name:"/channel/weapp/code"},null,8,["label"])]),_:1},8,["modelValue"]),t(Q,{class:"box-card !border-none",shadow:"never"},{default:p(()=>[d("div",Be,[t(g,{type:"primary",onClick:z,loading:f.value,disabled:a.loading},{default:p(()=>[h(s(n(e)("cloudRelease")),1)]),_:1},8,["loading","disabled"]),t(g,{onClick:A,disabled:a.loading},{default:p(()=>[h(s(n(e)("localRelease")),1)]),_:1},8,["disabled"])]),Z((w(),ee($,{class:"mt-[15px]",data:a.data,size:"default"},{empty:p(()=>[d("span",null,s(n(e)("emptyData")),1)]),default:p(()=>[t(b,{prop:"version",label:n(e)("code"),align:"left"},null,8,["label"]),t(b,{prop:"status_name",label:n(e)("status"),align:"left"},{default:p(({row:i})=>[d("div",null,s(i.status_name),1),i.status==-1?(w(),B("div",ke,s(n(e)("failReason"))+s(i.fail_reason),1)):F("",!0)]),_:1},8,["label"]),t(b,{prop:"create_time",label:n(e)("createTime"),align:"center"},null,8,["label"]),t(b,{label:n(e)("operation"),fixed:"right",align:"right","min-width":"120"},{default:p(({row:i,$index:O})=>[v.value&&O==0&&i.status==1&&a.page==1?(w(),B("div",Re,[t(S,{content:v.value,"raw-content":"",effect:"light"},{default:p(()=>[t(g,{type:"primary",link:""},{default:p(()=>[h(s(n(e)("preview")),1)]),_:1})]),_:1},8,["content"])])):F("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[K,a.loading]]),d("div",Ue,[t(H,{"current-page":a.page,"onUpdate:current-page":l[1]||(l[1]=i=>a.page=i),"page-size":a.limit,"onUpdate:page-size":l[2]||(l[2]=i=>a.limit=i),layout:"total, sizes, prev, pager, next, jumper",total:a.total,onSizeChange:u,onCurrentChange:u},null,8,["current-page","page-size","total"])])]),_:1}),t(J,{modelValue:E.value,"onUpdate:modelValue":l[7]||(l[7]=i=>E.value=i),title:n(e)("codeDownTwoDesc"),width:"30%","before-close":L},{footer:p(()=>[d("span",ze,[t(g,{onClick:l[6]||(l[6]=i=>E.value=!1)},{default:p(()=>[h(s(n(e)("cancel")),1)]),_:1}),t(g,{type:"primary",onClick:z},{default:p(()=>[h(s(n(e)("confirm")),1)]),_:1})])]),default:p(()=>[t(G,{ref_key:"ruleFormRef",ref:U,model:m.value,rules:o.rules,"label-width":"120px"},{default:p(()=>[t(T,{prop:"code",label:n(e)("code")},{default:p(()=>[t(D,{modelValue:m.value.code,"onUpdate:modelValue":l[3]||(l[3]=i=>m.value.code=i),placeholder:n(e)("codePlaceholder"),onkeyup:"this.value = this.value.replace(/[^\\d\\.]/g,'');"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(T,{prop:"path",label:n(e)("path")},{default:p(()=>[t(q,{modelValue:m.value.path,"onUpdate:modelValue":l[4]||(l[4]=i=>m.value.path=i),api:"weapp/upload",accept:".zip"},null,8,["modelValue","accept"])]),_:1},8,["label"]),t(T,{label:n(e)("content")},{default:p(()=>[t(D,{type:"textarea",modelValue:m.value.content,"onUpdate:modelValue":l[5]||(l[5]=i=>m.value.content=i),placeholder:n(e)("contentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});const Yt=Ve(We,[["__scopeId","data-v-fb56fac6"]]);export{Yt as default};
